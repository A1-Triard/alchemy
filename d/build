#!/bin/sh

basedir="$(dirname "$0")"
cd "$basedir"
echo "MW"
./make_scripts || exit 1
echo "Done MW"
echo "MFR"
./make_scripts_mfr || exit 1
echo "Done MFR"

find scripts -type f -exec basename {} \; | sort > all_scripts
cat scripts.list | sort | awk '{ print "A1V5_" $0 }' > sorted_scripts
diff sorted_scripts all_scripts || exit 1
rm all_scripts sorted_scripts
cat h > A.sctx
cd scripts
for script in *; do
  echo '' >> ../A.sctx
  echo "SCPT" >> ../A.sctx
  echo "SCHD ${script} 0 0 0 0 0" >> ../A.sctx
  cat $script >> ../A.sctx
done
cd ..

find scripts_mfr -type f -exec basename {} \; | sort > all_scripts_mfr
cat scripts_mfr.list | sort | awk '{ print "A1V5_" $0 }' > sorted_scripts_mfr
diff sorted_scripts_mfr all_scripts_mfr || exit 1
rm all_scripts_mfr sorted_scripts_mfr
cat h_mfr > B.sctx
cd scripts_mfr
for script in *; do
  echo '' >> ../B.sctx
  echo "SCPT" >> ../B.sctx
  echo "SCHD ${script} 0 0 0 0 0" >> ../B.sctx
  cat $script >> ../B.sctx
done
cd ..

../espa -v A.sctx
rm A.sctx
awk '{ print "A1V5_" $0 }' scripts.list > slist
../compile_scripts A.sctx slist
rm slist
mv A.sctx.esp ..
mv A.sctx.au3 ..

../espa -v B.sctx
rm B.sctx
awk '{ print "A1V5_" $0 }' scripts_mfr.list > smfrlist
../compile_scripts B.sctx smfrlist
rm smfrlist
mv B.sctx.esp ..
mv B.sctx.au3 ..
